@page
@model SM.APP.Pages.Admin.Members.SearchModel
@{
    ViewData["Title"] = "Member Search";
}

<div class="container mt-4" id="main-container">
    <partial name="_LoadingPartial" />
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-2">
        <h4 class="mb-0">Member Search <span id="counter" class="text-muted fw-normal"></span></h4>
        <div>
            <a href="/Admin/Members/Create" class="btn btn-success">
                <i class="bi bi-plus-circle me-1"></i> Create Member
            </a>
            <button class="btn btn-outline-primary" id="refresh-btn">
                <i class="bi bi-arrow-clockwise me-1"></i> Refresh
            </button>
        </div>
    </div>
    <ul class="nav nav-tabs mb-3" id="searchTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="code-search-tab" data-bs-toggle="tab" data-bs-target="#code-search-pane" type="button" role="tab" aria-controls="code-search-pane" aria-selected="true">
                <i class="bi bi-search me-1"></i> Search by Code
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="filter-search-tab" data-bs-toggle="tab" data-bs-target="#filter-search-pane" type="button" role="tab" aria-controls="filter-search-pane" aria-selected="false">
                <i class="bi bi-filter-circle me-1"></i> Advanced Filter
            </button>
        </li>
    </ul>
    <div class="tab-content" id="searchTabsContent">
        <div class="tab-pane fade show active p-3 border rounded bg-light" id="code-search-pane" role="tabpanel" aria-labelledby="code-search-tab">
            <div class="row align-items-end">
                <div class="col">
                    <label for="code-search-input" class="form-label">Search by Code, File Number, or Personal Number</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="code-search-input" placeholder="Enter search term...">
                        <button class="btn btn-outline-secondary" type="button" id="scanMemberCodeBtnSearch" title="Scan QR Code">
                            <i class="bi bi-qr-code-scan"></i>
                        </button>
                    </div>
                    <div id="qrScannerContainerSearch" class="mt-3 d-none">
                        <div id="reader" style="width: 100%;"></div>
                        <button id="btnStopScanSearch" class="btn btn-danger mt-2">Stop Scanning</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane fade p-3 border rounded bg-light" id="filter-search-pane" role="tabpanel" aria-labelledby="filter-search-tab">
            <form id="advanced-filter-form">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="first-name-filter" class="form-label small">First Name</label>
                                <input type="text" class="form-control" id="first-name-filter">
                            </div>
                            <div class="col-md-6">
                                <label for="last-name-filter" class="form-label small">Last Name</label>
                                <input type="text" class="form-control" id="last-name-filter">
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="active-filter" class="form-label small">Active Status</label>
                                <select id="active-filter" class="form-select">
                                    <option value="all" selected>Show All</option>
                                    <option value="true">Active Only</option>
                                    <option value="false">Inactive Only</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="baptised-filter" class="form-label small">Baptism Status</label>
                                <select id="baptised-filter" class="form-select">
                                    <option value="all" selected>Show All</option>
                                    <option value="true">Baptised Only</option>
                                    <option value="false">Not Baptised Only</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="card-status-filter" class="form-label small">Card Status</label>
                                <select id="card-status-filter" class="form-select">
                                    <option value="all" selected>All Statuses</option>
                                    <option value="MissingPhoto">Missing Photo</option>
                                    <option value="ReadyToPrint">Ready to Print</option>
                                    <option value="Printed">Printed</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="NotApplicable">Not Applicable</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <label for="class-filter" class="form-label small">Class(es)</label>
                        <select id="class-filter" class="selectpicker" multiple data-live-search="true" title="Any Class" data-width="100%" data-actions-box="true" data-selected-text-format="count > 3"></select>
                        <div class="d-flex justify-content-between mt-2">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="class-filter-operator" checked>
                                <label class="form-check-label small" for="class-filter-operator" id="class-filter-operator-label">Match ANY (OR)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="not-in-class-filter">
                                <label class="form-check-label small" for="not-in-class-filter">
                                    Not Assigned
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label small">Birthdate Range</label>
                                <div class="input-group">
                                    <input type="date" class="form-control" id="birthdate-start-filter">
                                    <span class="input-group-text">to</span>
                                    <input type="date" class="form-control" id="birthdate-end-filter">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Age Range</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="age-start-filter" placeholder="Min">
                                    <span class="input-group-text">to</span>
                                    <input type="number" class="form-control" id="age-end-filter" placeholder="Max">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 text-end">
                        <button type="button" class="btn btn-secondary" id="reset-filters-btn">Reset</button>
                        <button type="button" class="btn btn-primary" id="apply-filters-btn">
                            <i class="bi bi-search me-1"></i> Search
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <hr class="my-4">

    <div id="grid-controls" class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="select-all-checkbox">
            <label class="form-check-label" for="select-all-checkbox">
                Select All Visible
            </label>
        </div>
        <div id="bulk-actions-dropdown" class="d-none">
            <div class="dropdown">
                <button class="btn btn-primary dropdown-toggle" type="button" id="bulk-actions-btn" data-bs-toggle="dropdown" aria-expanded="false">
                    Actions (<span id="selected-count">0</span>)
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bulk-actions-btn">
                    <li><a class="dropdown-item" href="#" data-action="print-card">Print Card</a></li>
                    <li><a class="dropdown-item" href="#" data-action="update-baptism">Update Baptism Status</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="#" data-action="delete-members">Delete Members</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row g-4" id="members-grid">
    </div>
</div>
<partial name="_MemberDetailsModalPartial" />
<partial name="_MemberEditModalPartial" />
@section Scripts {
    <script>
        var apiBaseUrl = '@Services.SMConfigurationManager.ApiBase';
    </script>

    <script src="~/js/funds/common.js" asp-append-version="true"></script>
    <script src="~/js/funds/listing.js" asp-append-version="true"></script>
    <script src="~/js/aids/listing.js" asp-append-version="true"></script>
    <script src="~/js/meetings/list-member-attendance.js" asp-append-version="true"></script>
    <script src="~/js/members/details.js" asp-append-version="true"></script>
    <script src="~/js/members/edit.js" asp-append-version="true"></script>
    <script src="~/js/members/search.js" asp-append-version="true"></script>
}